\titleSlide

\frame{%
    \frametitle{\$::user}
    \framesubtitle{Julien Pivotto}
    \begin{itemize}
        \item{Open-Source consultant at {\inuits{}inuits\small.eu}}
        \item{Puppet User since 2011}
        \item{Speaker/attendee at Puppetcamps}
        \item{Member of the Belgian PUG}
        \item{Puppet core contributor}
        \item{Puppet(labs) modules contributor}
        \olditem{\textit{\ctr{@roidelapluie}} \ctr{on irc/twitter/github}}
    \end{itemize}

}

\inuitsSlide

\begin{iframe}[Welcome in 2015]
\item Virtualization
\item Containers
\item Cloud
\item Stateless software
\item Scalable daemons
\end{iframe}
\begin{frame}
    \frametitle{Distributing Software}
    \begin{itemize}\pause
        \item {Plain FTP (+SCM)}\pause
        \item {Tarball}\pause
        \item {Self-extracting tarball}\pause
        \item {curl|bash}\pause
        \item{Containers? What's inside?}\pause
        \item {Packages (.deb,~.rpm,\dots)}
    \end{itemize}
\end{frame}
\frame[b]{%
    \largepic{entreprise.jpg}
    \begin{center}\Huge{}\ctr{Real World}\end{center}
    \sethlcolor{black}
    \flushright\minuscule{Licensed under a Creative Commons Attribution 2.0 License\\https://www.flickr.com/photos/kwarz/13293732384/}
}


\begin{iframe}[Welcome in the real world]
\item Complex SW
\item Self-hosting
\item Stateless software
\item Scalable daemons
\end{iframe}

\begin{iframe}[Software distribution]
\item Software (Source code or binaries)
\item User guide
\item Installation guide
\end{iframe}

\begin{iframe}[Software distribution in entreprise]
\item Software (Source code or binaries)
\item People who install the software
\end{iframe}

\begin{iframe}[Challenges of SW distribution]
\item Artifacts
\item Security
\item HW requirements
\item SW requirements
\item Upgrades
\item Maintenances
\item Monitoring
\end{iframe}
\begin{iframe}[Closing the gap]
\item Bringing the entreprise in 2015
\item Between people in the chain
    \begin{itemize}
        \item Developers
        \item Managers
        \item Support people
        \item Services
    \end{itemize}
\item A DevOps World
\item Culture, Automation, Monitoring, Sharing
\end{iframe}

\CenterSlide{Introduction}
\begin{frame}
    \frametitle{Packaging}
    \begin{itemize}
        \item {Consistency checks, file lists}
        \item {Dependencies resolving}
        \item {Repositories}
        \item {GPG-Signing}
        \item {Lots of tools}
        \item {Versioning}
        \item {Unique artifacts, reproducible build}
        \item{CfgMgmt integration (Puppet, Chef\dots)}
    \end{itemize}
\end{frame}

\begin{iframe}[Dependencies]
\item{Prefer distro packages}
\item{Upstream packages}
\item{Reliable repos (EPEL?)}
\item{More dependencies = more work}
\end{iframe}

\begin{frame}
\LARGE
This talk is about how to ship Puppet code with your application, to be used at customers on platforms you do not manage.
\end{frame}
\CenterSlide{Automation}

\begin{iframe}[Automation]
\item Automate all the things
\item OS, Monitoring, Application
\item Reproducable builds
\item Repositories management
\end{iframe}
\begin{iframe}[Cultural changes]
\item No more manual work
\item Use an appropriate toolchain
\item Manual action = Error prone
\item What did I change 3 years ago?
\end{iframe}

\begin{iframe}[Documentation]
\item No more complex install guides
\item Puppet 101
\item One stack for several products
\end{iframe}

\frame[b]{%
    \largepic{puppet.jpg}
    %\sethlcolor{black}
    \flushright\minuscule{Licensed under a Creative Commons Attribution 2.0 License\\https://www.flickr.com/photos/jimmcd/4859841581}
}

\begin{iframe}[Puppet]
\item Widely used Automation tool\pause
\item Very mature\pause
\item Client/Server mode\pause
\item Standalone mode\pause
\item Declarative\pause
\item Scales
\end{iframe}

\begin{frame}
    \frametitle{What to automate?}
    \huge
    Application\\
    Reverse Proxy / Databases\\
    Monitoring\\
    Operation System\\
    Platform
\end{frame}

\begin{frame}
    \frametitle{To manage or not?}
    \huge You have to be able to chose which part you will setup with Puppet.
\end{frame}
\begin{frame}
    \frametitle{Use Puppet modules}
    \huge Use separate meta-modules for OS, Dependencies, Monitoring, Application\dots{} And include them only of needed.
\end{frame}

\begin{iframe}[Yes, no or noop]
\item Include or not each class
\item You can put a whole class in no-op
\item{\texttt{include myapp\_os}}
\item{\texttt{class \{'myapp\_os': noop => true,\}}}
\end{iframe}

\CenterSlide{Puppet Modules}

\begin{iframe}[External modules]
\item Pick the best ones
\item Puppetlabs modules
\item Upstream modules
\item Modules active on Github
\item Forge rating
\item Testing, doc
\item Modules that fit your usecase
\end{iframe}

\begin{frame}\LARGE Review the modules you plan to include. You do not want bad code in your app, why would you want it in the code that deploys your app?\end{frame}

\begin{iframe}[Contribute back]
\item Get feedback (peer review)
\item Easier to maintain in long term
\item Forces you to write tests
\item Help other people
\item Puppet is not your core business
\end{iframe}

\CenterSlide{Your modules}

\begin{iframe}
\item Everyone has write access
\item Follow code standards (puppet-lint)
\item Be future-proof
\item Separation between code and data
\end{iframe}

\CenterSlide{Your Tree}
\begin{iframe}
\item Your tree is next to your app code
\item Submodules of your app
\item Gets the same version number
\item Contains the right parameters
\end{iframe}

\CenterSlide{Agent or Masterless}

\begin{iframe}[Agent or masterless]
\item Puppet has 2 modes
\item Pull your catalog
\item Apply it from files
\item Both have advantages
\item Depends on what you want
\end{iframe}
\begin{iframe}[Masterless]
\item One-time run
\item No daemon running
\item No need for a Puppet master
\item No exported resources
\item No PuppetDB
\end{iframe}
\begin{iframe}[Puppet agent]
\item Run every X time
\item Sanity check
\item Requires one master
\item Puppet daemon running
\item Reports sent to the master
\end{iframe}
\begin{iframe}[PuppetDB]
\item Requires a master
\item Stores facts and reports
\item Easy to query
\item Dashboards available
\item Exported resources
\end{iframe}
\begin{iframe}[Security]
\item Puppet agent runs as root
\item Not the master
\item Isolate the master
\item Puppet reports show what changes in time
\item And detects problems earlier
\end{iframe}
\begin{iframe}[Security - Master/Server]
\item Do not use autosign
\item You can rely on external CA
\item Put a reverse proxy (even for server)
\item Isolate the service from the application
\item PuppetDB only listens to Loopback
\end{iframe}

\CenterSlide{Hiera}

\begin{iframe}[Hiera]
\item Data separation
\item You classes should have a stable API
\item Your main class dispatches to other modules
\item Use functions:
\begin{itemize}
    \item create\_resource
    \item mysql\_deepmerge
\end{itemize}
\end{iframe}
\begin{iframe}[Automatic Parameter Lookup]
\item{\texttt{class::param: "foobar"}}
\item Available in Puppet 3+
\item Should be avoided (obscurification)
\item Nice to have for edge cases
\end{iframe}

\CenterSlide{Pre Existing Puppet}

\begin{iframe}[Pre Existing Puppet]
\item There might be a puppet setup
\item Work in a separated environment
\item Puppet hieradata in a subdirectory
\item Prefix your custom functions
\item Be careful with exported resources
\end{iframe}

\CenterSlide{Conclusion}
\begin{iframe}[Shipping with puppet code]
\item Everyone gets benefits
\item From devs to QA to customers
\item Need to review how you release
\item Puppet code is part of your app
\end{iframe}
\begin{iframe}[Advantages]
\item Setup your app easily (internally and externally)
\item Bring innovation more easily
\item Get a clear view of the infrastructure
\item Say bye bye to long procedures
\end{iframe}
\begin{iframe}[There is work]
\item Big cultural changes
\item Purge old artifacts on updates
\item Deal with your data
\item Convincing people
\item Keep that infra up to date
\end{iframe}

\begin{iframe}[Challenges]
\item Monitoring
\item Flexibility
\item Culture
\item Learning
\end{iframe}

\thankyouSlide
\renewcommand{\insertLogo}{}
\contactSlide
